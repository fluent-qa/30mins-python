# 🥌 接口开发 & 记录操作日志


## 1.11.x 及以下版本
[https://www.yuque.com/erupts/1.11.x/nitieg](https://www.yuque.com/erupts/1.11.x/nitieg)


## 1.12.x 及以上版本
> 由于@EruptRouter注解使用难度较高，定义全新的权限注解API


### 接口示例
```java
@RestController
@RequestMapping("/test")
public class TestController {

    // 登录可访问
    @GetMapping("/api-a")
    @EruptLoginAuth
    @EruptRecordOperate("登录可调用") //记录操作日志，可不定义
    public void api() {
    	//TODO
    }
    
    
	// 拥有对应权限可访问
    @GetMapping("/api-b")
    @EruptMenuAuth("xxx") //匹配菜单类型值
    @EruptRecordOperate("拥有菜单权限可调用") //记录操作日志，可不定义
    public void api2() {
    	//TODO
    }
    
    
    @GetMapping("/api-x") //普通接口，不鉴权
    public void api3(String param) {
    	//TODO
    }
    
    @RequestMapping("/api-y") //普通接口且记录请求日志
    @EruptRecordOperate("记录请求日志")
    public void api4(String param) {
    	//TODO
    }
    
}
```


### 接口请求
前端请求 EruptLoginAuth、EruptMenuAuth 注解修饰的接口时，必须传递 token ，且放到请求头中


#### 获取token方法
```javascript
//方法1：如果使用tpl模块则需要通过如下js脚本获取，注意只有登录成功才能获取到token
parent.getAppToken().token

//方法2：通过url参数动态获取
var token = new URLSearchParams(location.search).get("_token")
```

#### 请求示例
请导入tpl模块后在模板文件中调用网络请求，token禁止外部跨域获取，必须在应用内部获取
```javascript
axios.get("http://127.0.0.1/erupt-api/test/api-b", {
    headers: {
        token: parent.getAppToken().token
    }
}).then((res) => {
    console.log(res)
})
```
```javascript
$.ajax({
    type: "GET",
    url: "http://127.0.0.1/erupt-api/test/api-a",
    headers: {
        token: parent.getAppToken().token
    },
    success: function(result) {
        console.log(result);
    }
});
```


### 前后端分离
如果采用前后端分离的方式调用需开始redisSession
```yaml
erupt:
  redisSession: true
spring:
  redis:
    database: 0
    timeout: 10000
    host: 127.0.0.1
```

注意：如果使用postman进行测试且未开启redis-session请在传递token的时同时传递cookie

## 



> 原文: <https://www.yuque.com/erupt/nitieg>